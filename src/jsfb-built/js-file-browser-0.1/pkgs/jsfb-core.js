/*
 * js-file-browser
 * Copyright(c) 2011 Biotechnology Computing Facility, University of Arizona. See included LICENSE.txt file.
 * 
 * With components from: Ext JS Library 3.3.1
 * Copyright(c) 2006-2010 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
/*
 * Ext JS Library 3.3.1
 * Copyright(c) 2006-2010 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.ns("Ext.ux.layout");Ext.ux.layout.CenterLayout=Ext.extend(Ext.layout.FitLayout,{setItemSize:function(b,a){this.container.addClass("ux-layout-center");b.addClass("ux-layout-center-item");if(b&&a.height>0){if(b.width){a.width=b.width}b.setSize(a)}}});Ext.Container.LAYOUTS["ux.center"]=Ext.ux.layout.CenterLayout;Ext.ns("jsfb","jsfb.data","jsfb.widgets");jsfb.widgets.Browser=Ext.extend(Ext.Panel,{constructor:function(a){var b={title:"JS File Browser",height:400,width:600,url:"",path:"/",layout:"fit"};Ext.apply(b,a);if(!b.fileAdapter){b.fileAdapter=new jsfb.data.RestAdapter()}if(!b.dataFormatter){b.dataFormatter=new jsfb.data.DataFormatter()}Ext.apply(this,b);jsfb.widgets.Browser.superclass.constructor.apply(this,arguments);this.logout()},showMessage:function(g){var e={msg:"",cls:"",showClose:true,timeout:7000};Ext.apply(e,g);if(!this.msgContainer){var b=Ext.query(".x-panel-body",this.el.dom)[0];this.msgContainer=Ext.DomHelper.append(b,{tag:"div",cls:"message-container"})}var a="message "+e.cls;var c=Ext.DomHelper.append(this.msgContainer,{tag:"div",cls:a,children:[{tag:"span",cls:"message-text",html:e.msg}]});var f=Ext.get(c);f.close=function(){this.remove()};if(e.showClose){var d=Ext.DomHelper.append(c,{tag:"div",cls:"message-close"});Ext.get(d).on("click",function(){f.close()})}if(e.timeout){setTimeout(function(){f.close()},e.timeout)}return f},showError:function(a){this.showMessage({msg:a?a:"System Error",cls:"error"})},showLoading:function(b){var a=Ext.query(".x-panel-body",this.el.dom)[0];Ext.DomHelper.append(a,{tag:"div",cls:"busy"});this.showMessage({msg:b?b:"Waiting...",cls:"load",showClose:false,timeout:0})},hideLoading:function(){var a=Ext.query(".busy",this.el.dom);if(a.length){Ext.get(a[0]).remove()}var b=Ext.query(".load",this.el.dom);if(b.length){Ext.get(b[0]).close()}},getApiConfig:function(){return{user:this.user,password:this.password,url:this.url,path:this.path}},getApiCallConfig:function(c){var a=this;var b=this.getApiConfig();Ext.apply(b,{success:function(){c.apply(this,arguments);a.hideLoading()},failure:function(d){a.hideLoading();a.showError(d)}});return b},login:function(){var a=this;var b=this.getApiCallConfig(function(c){a.loggedIn=true;a.setData(c)});this.showLoading();this.fileAdapter.login(b)},logout:function(){var a=this;if(this.loggedIn){var b=this.getApiCallConfig(function(c){a.loggedIn=false;a.setData(c)});this.showLoading();this.fileAdapter.logout(b)}if(!this.loginWidget){this.removeAll();this.loginWidget=this.add({layout:"ux.center",border:false,items:[{xtype:"jsfblogin",user:this.user,password:this.password,url:this.url,path:this.path,listeners:{login:function(d,c){Ext.apply(a,c);a.login()}}}]})}else{if(this.items.indexOf(this.loginWidget)<0){this.removeAll();this.add(this.loginWidget)}}this.doLayout()},changePath:function(c){var a=this;this.path=c;console.log("Changed Path: "+this.path);var b=this.getApiCallConfig(function(d){console.log("Got Data!");console.log(d);a.setData(d)});this.showLoading();this.fileAdapter.list(b)},makeDir:function(c){var a=this;var b=this.getApiCallConfig(function(){a.changePath(a.path)});b.name=c;this.showLoading();this.fileAdapter.makeDir(b)},renamePath:function(c,e){var a=this;var d=e.name;var b=this.getApiCallConfig(function(){if(Ext.isArray(a.data)){a.changePath(a.path)}else{var f=new RegExp(d+"$");var g=e.path.replace(f,c);a.changePath(g)}});b.item=e;b.name=c;this.showLoading();this.fileAdapter.renamePath(b)},deletePath:function(c){var a=this;var b=this.getApiCallConfig(function(){a.changePath(a.path)});b.item=c;this.showLoading();this.fileAdapter.deletePath(b)},upload:function(c){var a=this;var b=this.getApiCallConfig(function(){a.changePath(a.path)});b.form=c;this.showLoading();this.fileAdapter.upload(b)},setData:function(b){var a=this;if(!this.fileGrid){this.removeAll();this.fileGrid=this.add({ref:"fileGrid",xtype:"jsfbfilegrid",border:false,listeners:{pathchange:function(d,c){a.changePath(c)},makedir:function(d,c){a.makeDir(c)},renamepath:function(e,c,d){a.renamePath(c,d)},removepath:function(d,c){a.deletePath(c)},upload:function(c){a.upload(c)}}});this.fileGrid.getSelectionModel().on("rowselect",function(f,c,e){if(a.callback){var d=a.getApiConfig();Ext.apply(d,e.data);a.callback.call(a,d)}})}else{if(this.items.indexOf(this.fileGrid)<0){this.add(this.fileGrid)}}this.doLayout();if(Ext.isArray(b)){Ext.each(b,function(c){a.dataFormatter.format(c)})}else{this.dataFormatter.format(b)}this.fileGrid.setData(this.path,b);this.fileGrid.getView().render();this.fileGrid.getView().refresh()}});Ext.reg("jsfbbrowser",jsfb.widgets.Browser);jsfb.widgets.FileDetailPanel=Ext.extend(Ext.Panel,{constructor:function(c){var a=this;if(!c.data){throw new Error('Attribute: "data" not specified.')}var e=[{label:"File",attr:"name"},{label:"Path",attr:"path"},{label:"Owner",attr:"owner"},{label:"Modified",attr:"modified"},{label:"Permissions",attr:"permissions"},{label:"Size",attr:"size"},{label:"File Type",attr:"type"},{label:"Mime Type",attr:"mimeType"},{label:"Download",attr:"download"}];var d='<table class="dl"><tbody>';Ext.each(e,function(f){if(c.data.hasOwnProperty(f.attr)&&c.data[f.attr]){d+="<tr><th>"+f.label+":</th><td>{"+f.attr+"}</td></tr>"}});d+="</tbody></table>";var b=new Ext.Template(d);defaults={border:false,frame:false,height:320,layout:"fit",html:b.apply(c.data),bbar:[{xtype:"button",text:"Rename",disabled:c.data.writable?false:true,icon:"jsfb/resources/images/document-rename.png",listeners:{render:function(f,g){new Ext.ToolTip({target:f.el,title:"Rename "+c.data.type+"."})},click:function(f,h){var g=new Ext.Window({renderTo:a.el,title:"Rename",width:300,padding:10,resizable:false,layout:"form",items:[{xtype:"form",ref:"renameForm",unstyled:true,padding:5,items:[{xtype:"textfield",width:150,fieldLabel:"Name",name:"name",value:c.data.name,allowBlank:false}]}],bbar:[{xtype:"button",text:"Rename",icon:"jsfb/resources/images/document-rename.png",handler:function(){var i=g.renameForm.getForm();if(i.isValid()){a.fireEvent("renamepath",a,i.getFieldValues().name,a.data);g.close()}}},"&nbsp;",{xtype:"button",text:"Cancel",icon:"jsfb/resources/images/close.png",handler:function(){g.close()}}]});g.show()}}},"&nbsp;",{xtype:"button",text:"Delete",icon:"jsfb/resources/images/document--minus.png",disabled:c.data.writable?false:true,listeners:{render:function(f,g){new Ext.ToolTip({target:f.el,title:"Delete "+c.data.type+"."})},click:function(f,h){var g=new Ext.Window({renderTo:a.el,title:"Delete "+c.data.path+"?",width:300,padding:10,resizable:false,html:"Permanently delete "+c.data.name+(c.data.type==="dir"?" and all children":"")+"?",bbar:[{xtype:"button",text:"Cancel",icon:"jsfb/resources/images/check.png",handler:function(){g.close()}},"&nbsp;",{xtype:"button",text:"Delete",icon:"jsfb/resources/images/close.png",handler:function(){a.fireEvent("removepath",a,a.data);g.close()}},]});g.show()}}}]};Ext.apply(defaults,c);Ext.apply(this,defaults);jsfb.widgets.FileDetailPanel.superclass.constructor.apply(this,arguments);a.addEvents("renamepath","removepath")}});Ext.reg("jsfbfiledetailpanel",jsfb.widgets.FileDetailPanel);jsfb.widgets.FileGrid=Ext.extend(Ext.grid.GridPanel,{constructor:function(b){var a=this;var c={viewConfig:{forceFit:true},frame:false,border:false,autoExpandColumn:"name",autoHeight:false,columnLines:true,stripeRows:true,showHidden:false,cls:"file-grid",tbar:{style:"padding-left: 5px",items:[]},bbar:{style:"padding-left: 5px",items:['<span class="label">Filter By:</span>&nbsp;',{id:"fileFilterInput",xtype:"textfield",value:b&&b.filter?b.filter:undefined,enableKeyEvents:true,listeners:{render:function(d,f){new Ext.ToolTip({target:d.el,title:"Filter files by name."})},keydown:function(g,h){var d=500;var f={};a.filterFunc=setTimeout(function(){if(f.filterFunc===a.filterFunc){a.filterData()}},d);f.filterFunc=a.filterFunc}}},"&nbsp;&nbsp;",{xtype:"button",ref:"goToParentBtn",icon:"jsfb/resources/images/folder-horizontal--arrow-90.png",listeners:{render:function(d,f){new Ext.ToolTip({target:d.el,title:"Go to parent directory."})},click:function(d,h){var g=a.getPathAsArray();var f="/"+g.slice(1,g.length-1).join("/");a.fireEvent("pathchange",a,f)}}},{xtype:"button",ref:"reloadBtn",icon:"jsfb/resources/images/folder-horizontal--arrow-315.png",listeners:{render:function(d,f){new Ext.ToolTip({target:d.el,title:"Refresh content."})},click:function(d,f){a.fireEvent("pathchange",a,a.path)}}},{xtype:"button",ref:"makeDirBtn",icon:"jsfb/resources/images/folder-horizontal--plus.png",listeners:{render:function(d,f){new Ext.ToolTip({target:d.el,title:"Create new directory."})},click:function(d,g){var f=new Ext.Window({renderTo:a.el,title:"New Directory",width:300,padding:10,resizable:false,layout:"form",items:[{xtype:"form",ref:"makeDirForm",unstyled:true,padding:5,items:[{xtype:"textfield",width:150,fieldLabel:"Name",name:"name",allowBlank:false}]}],bbar:[{xtype:"button",text:"Create",icon:"jsfb/resources/images/folder-horizontal--plus.png",handler:function(){var e=f.makeDirForm.getForm();if(e.isValid()){a.fireEvent("makedir",a,e.getFieldValues().name);f.close()}}},"&nbsp;",{xtype:"button",text:"Cancel",icon:"jsfb/resources/images/close.png",handler:function(){f.close()}}]});f.show()}}},{xtype:"button",ref:"uploadBtn",icon:"jsfb/resources/images/document--plus.png",listeners:{render:function(d,f){new Ext.ToolTip({target:d.el,title:"Upload file."})},click:function(d,g){var f=new Ext.Window({renderTo:a.el,title:"Upload File",width:300,padding:10,resizable:false,layout:"form",items:[{xtype:"form",ref:"uploadForm",fileUpload:true,unstyled:true,padding:5,html:"Not Implemented yet!",}],bbar:[{xtype:"button",text:"Upload",icon:"jsfb/resources/images/document--plus.png",handler:function(){var e=f.uploadForm.getForm();if(e.isValid()){a.fireEvent("upload",a,e);f.close()}}},"&nbsp;",{xtype:"button",text:"Cancel",icon:"jsfb/resources/images/close.png",handler:function(){f.close()}}]});f.show()}}}]}};Ext.apply(c,b);if(!c.store){c.store=new Ext.data.JsonStore({storeId:"dirListing",autoDestroy:true,root:"files",idProperty:"path",fields:["name","path",{name:"lastModified",type:"date",dateFormat:"time"},"length","owner","permissions","mimetype","modified","size","type","writable"]})}if(!c.colModel){c.colModel=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{id:"name",header:"Filename",dataIndex:"name",renderer:function(h,d,g){var f=a.getIcon(g.data);var e="background-image: url(jsfb/resources/images/"+f+");";return'<div class="filename" style="'+e+'">'+h+"</div>"}},{header:"Status",dataIndex:"permissions",width:20,renderer:function(f,d,e){return a.getFileStatus(e.data)}},{header:"Size",dataIndex:"size",width:35,},{header:"Modified",dataIndex:"modified",width:75}]})}Ext.apply(this,c);jsfb.widgets.FileGrid.superclass.constructor.apply(this,arguments);this.on("rowdblclick",function(f,g,h){var d=a.getStore().getAt(g);if(d.data.type==="dir"){a.fireEvent("pathchange",a,d.data.path)}else{a.setData(d.data.path,d.data)}});this.addEvents("pathchange","makedir","renamepath","removepath","upload")},getPathAsArray:function(){return this.path.split("/")},setData:function(b,a){this.path=b;this.data=a;this.updateLocation();if(Ext.isArray(a)){this.filterData();this.disableControls(a)}else{this.fileDetails()}},disableControls:function(a){var b=this.getBottomToolbar();if(a&&a[0].writable){b.makeDirBtn.enable();b.uploadBtn.enable()}else{b.makeDirBtn.disable();b.uploadBtn.disable()}if(a&&this.getPathAsArray().length>1){b.goToParentBtn.enable()}else{b.goToParentBtn.disable()}},updateLocation:function(d){var b=this;var a=this.getTopToolbar();a.removeAll();var c=this.getPathAsArray();Ext.each(c,function(f,e){if(f===""){return}if(f.length>15){f=f.substr(0,9)+"..."+f.substr(f.length-3,3)}var g=c.slice(0,e+1).join("/");a.add({xtype:"button",text:f,minWidth:20,listeners:{render:function(h,i){new Ext.ToolTip({target:h.el,title:"Go to: "+g})},click:function(h,i){b.fireEvent("pathchange",b,g)}}});a.add("&nbsp;")})},filterData:function(){var a=this;var d=Ext.get("fileFilterInput").getValue().split(/,|\s/);var e;if(d){var c=[];Ext.each(d,function(f){f=f.replace(".","\\.");f=f.replace(/^\s+|\s+$/g,"");c.push(f)});e=new RegExp(c.join("|"),"i")}var b=[];Ext.each(this.data,function(f){if(!f){return}if((!this.showHidden)&&f.name.indexOf(".")===0){return}if(e&&(!e.test(f.name))){return}b.push(f)});this.store.loadData({files:b})},getIcon:function(b){var a;if(b.type==="dir"){a=this.getDirIcon(b)}else{if(b.type==="file"){a=this.getFileIcon(b)}else{a="document.png"}}return a},getDirIcon:function(a){return"folder-horizontal.png"},getFileIcon:function(c){var a={fasta:"document-dna.png",fa:"document-dna.png",fastq:"document-dna.png",fq:"document-dna.png",txt:"document-text.png",rtf:"document-text.png",csv:"document-table.png",xls:"document-excel-table.png",doc:"document-word-text.png",ppt:"document-powerpoint.png",pdf:"document-pdf.png",html:"document-xaml.png",xml:"document-code.png",png:"image.png",gif:"image.png",tiff:"image.png",jpg:"image.png",jpeg:"image.png"};var d=c.name.split(".");if(d.length){var b=d[d.length-1];if(a.hasOwnProperty(b)){return a[b]}}return"document.png"},getFileStatus:function(c){var b='<div class="file-status">';if(c.writable){b+='<div style="background-image: url(jsfb/resources/images/lock-unlock.png);"></div>'}else{b+='<div style="background-image: url(jsfb/resources/images/lock.png);"></div>'}var a="var fb = Ext.getCmp('"+this.id+"'); fb.pathDetails('"+c.path+"'); return false;";b+='<a onclick="'+a+'"><div style="background-image: url(jsfb/resources/images/information-frame.png);"></div></a>';b+="</div>";return b},pathDetails:function(c){for(var a=0;a<this.data.length;a++){var b=this.data[a];if(b.path===c){this.setData(b.path,b);break}}},fileDetails:function(){var b=this;var a=Ext.query(".x-panel-body",this.el.dom)[0];a.innerHTML="";var c=new jsfb.widgets.FileDetailPanel({renderTo:a,data:this.data,listeners:{renamepath:function(f,d,e){b.fireEvent("renamepath",b,d,e)},removepath:function(e,d){b.fireEvent("removepath",b,d)}}});this.disableControls()}});Ext.reg("jsfbfilegrid",jsfb.widgets.FileGrid);jsfb.widgets.Login=Ext.extend(Ext.FormPanel,{constructor:function(b){var a=this;var c={title:"Login",width:400,autoHeight:true,padding:10,cls:"login",items:[{xtype:"textfield",width:250,fieldLabel:"User",name:"user",allowBlank:false,value:b&&b.user?b.user:undefined},{xtype:"textfield",width:250,inputType:"password",fieldLabel:"Password",name:"password",allowBlank:false,value:b&&b.password?b.password:undefined},{xtype:"textfield",width:250,fieldLabel:"Server",name:"url",allowBlank:false,value:b&&b.url?b.url:undefined}],bbar:[{xtype:"button",text:"Login",icon:"jsfb/resources/images/door--arrow.png",handler:function(){a.login()}}]};Ext.apply(c,b);Ext.apply(this,c);jsfb.widgets.Login.superclass.constructor.apply(this,arguments);this.addEvents("login")},login:function(){var a=this.getForm();if(a.isValid()){var b=a.getFieldValues();b.path=b.user;this.fireEvent("login",this,b)}}});Ext.reg("jsfblogin",jsfb.widgets.Login);Ext.util.base64={base64s:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",encode:function(c){if(typeof btoa==="function"){return btoa(c)}var f=this.base64s;var b;var e;var a=0;var d="";while(c.length>=a+3){b=(c.charCodeAt(a++)&255)<<16|(c.charCodeAt(a++)&255)<<8|c.charCodeAt(a++)&255;d+=f.charAt((b&16515072)>>18)+f.charAt((b&258048)>>12)+f.charAt((b&4032)>>6)+f.charAt((b&63))}if(c.length-a>0&&c.length-a<3){e=Boolean(c.length-a-1);b=((c.charCodeAt(a++)&255)<<16)|(e?(c.charCodeAt(a)&255)<<8:0);d+=f.charAt((b&16515072)>>18)+f.charAt((b&258048)>>12)+(e?f.charAt((b&4032)>>6):"=")+"="}return(d)},decode:function(c){if(typeof atob==="function"){return atob(c)}var e=this.base64s;var d;var a="";var b=0;for(;b<c.length;b+=4){d=(e.indexOf(c.charAt(b))&255)<<18|(e.indexOf(c.charAt(b+1))&255)<<12|(e.indexOf(c.charAt(b+2))&255)<<6|e.indexOf(c.charAt(b+3))&255;a+=String.fromCharCode((d&16711680)>>16,(d&65280)>>8,d&255)}if(c.charCodeAt(b-2)==61){return(a.substring(0,a.length-2))}else{if(c.charCodeAt(b-1)==61){return(a.substring(0,a.length-1))}else{return(a)}}}};jsfb.data.TestAdapter=Ext.extend(Object,{fakeDirectory:[{name:"..",path:"/api_sample_user/",lastModified:1294357013000,length:409600,owner:"api_sample_user",permisssions:"all",mimeType:"",format:"folder",type:"dir"},{name:"FWA1.fa",path:"/api_sample_user/FWA1.fa",lastModified:1294435955000,length:2644,owner:"api_sample_user",permisssions:"all",format:"FASTA-0",mimeType:"application/binary",type:"file"},{name:"landsberg.small.fastq",path:"/api_sample_user/landsberg.small.fastq",lastModified:1294429807000,length:40960000,owner:"api_sample_user",permisssions:"all",format:"FASTQ-0",mimeType:"application/binary",type:"file"},{name:"landsberg.tiny.fastq",path:"/api_sample_user/landsberg.tiny.fastq",lastModified:1294436800000,length:409600,owner:"api_sample_user",permisssions:"all",format:"FASTQ-0",mimeType:"application/binary",type:"file"},{name:"sample.fq",path:"/api_sample_user/sample.fq",lastModified:1294425606000,length:409600,owner:"api_sample_user",permisssions:"all",format:"FASTQ-0",mimeType:"application/binary",type:"file"},{name:"test.fasta",path:"/api_sample_user/test.fasta",lastModified:1294429977000,length:2422,owner:"api_sample_user",permisssions:"all",format:"FASTA-0",mimeType:"application/binary",type:"file"},{name:"ShinyNewDirectory",path:"/api_sample_user/ShinyNewDirectory",lastModified:1294422460000,length:0,owner:"api_sample_user",permisssions:"all",format:"raw",mimeType:"",type:"dir"}],login:function(a){if(a.success){a.success(this.fakeDirectory)}},logout:function(a){if(a.success){a.success()}},list:function(a){var b=this.fakeDirectory;if(a.success){a.success(b)}},makeDir:function(a){this.fakeDirectory.push({name:a.name,path:a.path+"/"+a.name,lastModified:Math.round((new Date()).getTime()/1000),length:0,owner:a.user,permisssions:"all",format:"folder",mimeType:"",type:"dir"});if(a.success){a.success()}},renamePath:function(a){a.item.name=a.newName;if(a.success){a.success()}},deletePath:function(a){var c;for(var b=0;b<this.fakeDirectory.length;b++){var d=this.fakeDirectory[b];if(d.path===a.item.path){c=b;break}}delete this.fakeDirectory[c];if(a.success){a.success()}}});jsfb.data.RestAdapter=Ext.extend(Object,{pathAsUrl:function(b){var a=b.split("/");var c=[];Ext.each(a,function(d){if(d){c.push(encodeURIComponent(d))}});return c.join("/")},failure:function(b,a,d){var g="Error";try{var c=Ext.decode(a.responseText);g=c.message}catch(f){}b.failure(g)},login:function(a){var b="Basic "+Ext.util.base64.encode(a.user+":"+a.password);Ext.Ajax.defaultHeaders={Authorization:"Basic "+Ext.util.base64.encode(a.user+":"+a.password)};Ext.Ajax.disableCaching=false;this.list(a)},logout:function(a){delete Ext.Ajax.defaultHeaders.Authorization;if(a.success){a.success()}},list:function(b){var a=this;Ext.Ajax.request({url:b.url+"/io-v1/io/list/"+this.pathAsUrl(b.path)+"/",success:function(c,e){var d=Ext.decode(c.responseText);b.success(d.result)},failure:function(c,d){a.failure(b,c,d)}})},makeDir:function(b){var a=this;Ext.Ajax.request({url:b.url+"/io-v1/io/"+this.pathAsUrl(b.path)+"/",params:{dirName:b.name,action:"mkdir"},method:"PUT",success:function(c,d){b.success()},failure:function(c,d){a.failure(b,c,d)}})},renamePath:function(b){var a=this;Ext.Ajax.request({url:b.url+"/io-v1/io/"+this.pathAsUrl(b.path)+"/",params:{newName:b.name,action:"rename"},method:"PUT",success:function(c,d){b.success()},failure:function(c,d){a.failure(b,c,d)}})},deletePath:function(b){var a=this;Ext.Ajax.request({url:b.url+"/io-v1/io/"+this.pathAsUrl(b.item.path)+"/",method:"DELETE",success:function(c,d){b.success()},failure:function(c,d){a.failure(b,c,d)}})},upload:function(a){console.log("not supported yet!")}});jsfb.data.DataFormatter=Ext.extend(Object,{getFileSize:function(a){var b=a.length;if(false){return}else{if(b>1099511627776){return(b/1099511627776).toFixed(1)+" TB"}else{if(b>1073741824){return(b/1073741824).toFixed(1)+" GB"}else{if(b>104857){return(b/104857).toFixed(1)+" MB"}else{if(b>0){return(b/1024).toFixed(1)+" KB"}else{if(a.type==="dir"){return"--"}else{return"empty"}}}}}}},format:function(b){b.size=this.getFileSize(b);b.modified=new Date(b.lastModified).format("M d Y h:m a");if(b.permisssion){b.permission=b.permisssion}var a=["own","all","write"];if(a.indexOf(b.permissions.toLowerCase())>-1){b.writable=true}else{b.writable=false}},});